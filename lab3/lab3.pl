% Zinkov Mikhail, var 8

:- use_module(library(crypto)).
:- use_module(library(clpfd)).

% Базовый перебор паролей (3 буквы + цифры)
найти_пароль(Хеш) :-
    length(Буквы, 3),
    maplist(буква, Буквы),  % Используем предикат буква вместо тип_символа
    length(Цифры, Д), Д in 1..3,  % От 1 до 3 цифр
    maplist(цифра, Цифры),  % Используем предикат цифра вместо тип_символа
    append(Буквы, Цифры, Пароль),
    atom_chars(ПарольАтом, Пароль),
    сумма_ascii(Пароль, Хеш),
    format('Найден пароль: ~w (Хеш: ~w)~n', [ПарольАтом, Хеш]).

% Остальной код остается без изменений
оптимизированный_поиск(Хеш) :-
    length(Буквы, 3),
    length(Цифры, Д), Д in 1..3,
    maplist(буква, Буквы),
    maplist(цифра, Цифры),
    сумма_ascii(Буквы, СуммаБукв),
    СуммаБукв #=< Хеш,
    append(Буквы, Цифры, Пароль),
    сумма_ascii(Пароль, Хеш),
    atom_chars(ПарольАтом, Пароль),
    format('Найден пароль: ~w (Хеш: ~w)~n', [ПарольАтом, Хеш]).

% Предикаты для проверки символов
буква(Символ) :-
    char_type(Символ, alpha).  % Проверка что символ буква (оба регистра)

цифра(Символ) :-
    char_type(Символ, digit).  % Проверка что символ цифра

% Вычисление суммы ASCII кодов
сумма_ascii([], 0).
сумма_ascii([Г|Х], Сумма) :-
    char_code(Г, Код),
    сумма_ascii(Х, Остаток),
    Сумма is Код + Остаток.

% Замер времени выполнения
замерить_время(Цель) :-
    statistics(runtime, [Начало|_]),
    call(Цель),
    statistics(runtime, [Конец|_]),
    Время is Конец - Начало,
    format('Поиск занял ~w мс~n', [Время]).

% Примеры использования:
% Поиск по сумме: ?- замерить_время(найти_пароль(350)).
% ---Result1
% Найден пароль: AAA029 (Хеш: 350)
% Поиск занял 149 мс
% true
% ---Result2
% Найден пароль: AAA038 (Хеш: 350)
% Поиск занял 48 мс
% true
% ---Result3
% Найден пароль: AAA047 (Хеш: 350)
% Поиск занял 60 мс
% true
% 
% 
% Оптимизированный: ?- замерить_время(оптимизированный_поиск(300)).
% ---Result1
% Найден пароль: AAq9 (Хеш: 300)
% Поиск занял 430 мс
% true
% ---Result2
% Найден пароль: AAr8 (Хеш: 300)
% Поиск занял 442 мс
% true
% ---Result3
% Найден пароль: AAs7 (Хеш: 300)
% Поиск занял 454 мс
% true
